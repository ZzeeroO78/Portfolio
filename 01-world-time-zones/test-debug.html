<!DOCTYPE html>
<html>
<head>
    <title>Debug Test - World Time Zones v5.3</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #1e1e1e; color: #d4d4d4; padding: 20px; }
        h1 { color: #4ec9b0; }
        .console { background: #252526; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #667eea; }
        .success { border-left-color: #28a745; color: #28a745; }
        .error { border-left-color: #dc3545; color: #dc3545; }
        .info { border-left-color: #17a2b8; color: #17a2b8; }
        .test-section { margin: 20px 0; padding: 15px; background: #2d2d2d; border-radius: 5px; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #5568d3; }
        #cities-output { background: #f0f0f0; color: #000; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üêõ Debug Test Console - v5.3</h1>
    
    <div class="test-section">
        <h2>Script Validation</h2>
        <div id="script-validation"></div>
    </div>
    
    <div class="test-section">
        <h2>Initialization Test</h2>
        <button onclick="testInit()">Run Init Test</button>
        <div id="init-result"></div>
    </div>
    
    <div class="test-section">
        <h2>API Test</h2>
        <button onclick="testAPI()">Test fetchRealWeather</button>
        <div id="api-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Cities Output</h2>
        <button onclick="showCities()">Show Cities Array</button>
        <div id="cities-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>
    
    <script>
        // Capture console logs
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            logs.push({ type: 'log', message: args.join(' ') });
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push({ type: 'error', message: args.join(' ') });
            originalError.apply(console, args);
        };
        
        // Load script
        const script = document.createElement('script');
        script.src = 'script.js?v=5.3';
        script.onload = function() {
            validateScript();
        };
        document.head.appendChild(script);
        
        function validateScript() {
            let html = '';
            
            // Check 1
            if (typeof defaultCities !== 'undefined' && Array.isArray(defaultCities)) {
                html += `<div class="console success">‚úì defaultCities exists (${defaultCities.length} cities)</div>`;
            } else {
                html += `<div class="console error">‚úó defaultCities missing or invalid</div>`;
            }
            
            // Check 2
            if (typeof cityCoordinates !== 'undefined' && Object.keys(cityCoordinates).length > 0) {
                html += `<div class="console success">‚úì cityCoordinates exists (${Object.keys(cityCoordinates).length} cities)</div>`;
            } else {
                html += `<div class="console error">‚úó cityCoordinates missing</div>`;
            }
            
            // Check 3
            if (typeof fetchRealWeather === 'function') {
                html += `<div class="console success">‚úì fetchRealWeather function exists</div>`;
            } else {
                html += `<div class="console error">‚úó fetchRealWeather missing</div>`;
            }
            
            // Check 4
            if (typeof updateWeather === 'function') {
                html += `<div class="console success">‚úì updateWeather function exists</div>`;
            } else {
                html += `<div class="console error">‚úó updateWeather missing</div>`;
            }
            
            // Check 5
            if (typeof renderCities === 'function') {
                html += `<div class="console success">‚úì renderCities function exists</div>`;
            } else {
                html += `<div class="console error">‚úó renderCities missing</div>`;
            }
            
            // Check 6
            if (cityCoordinates['london'] && cityCoordinates['london'].lat === 51.5074) {
                html += `<div class="console success">‚úì London coordinates correct</div>`;
            } else {
                html += `<div class="console error">‚úó London coordinates incorrect</div>`;
            }
            
            // Check 7
            if (cityCoordinates['sarajevo'] && cityCoordinates['sarajevo'].lat === 43.8564) {
                html += `<div class="console success">‚úì Sarajevo coordinates found</div>`;
            } else {
                html += `<div class="console error">‚úó Sarajevo coordinates missing</div>`;
            }
            
            document.getElementById('script-validation').innerHTML = html;
        }
        
        async function testInit() {
            const div = document.getElementById('init-result');
            div.innerHTML = '<div class="console info">‚è≥ Testing initialization...</div>';
            
            try {
                // Clear localStorage
                localStorage.clear();
                
                // Reload script globals
                window.cities = [];
                
                // Simulate init
                loadSettings();
                loadCitiesFromStorage();
                if (!cities || cities.length === 0) {
                    cities = JSON.parse(JSON.stringify(defaultCities));
                }
                
                let html = `<div class="console success">‚úì Init successful</div>`;
                html += `<div class="console info">Cities loaded: ${cities.length}</div>`;
                cities.forEach(city => {
                    html += `<div class="console info">  - ${city.name} (${city.timezone})</div>`;
                });
                
                div.innerHTML = html;
            } catch (e) {
                div.innerHTML = `<div class="console error">‚úó Init failed: ${e.message}</div>`;
            }
        }
        
        async function testAPI() {
            const div = document.getElementById('api-result');
            div.innerHTML = '<div class="console info">‚è≥ Testing fetchRealWeather...</div>';
            
            try {
                const result = await fetchRealWeather('London');
                
                if (result) {
                    let html = `<div class="console success">‚úì API call successful</div>`;
                    html += `<div class="console info">London: ${result.temp}¬∞C, ${result.humidity}% humidity</div>`;
                    html += `<div class="console info">Weather code: ${result.weatherCode}, Is day: ${result.isDay}</div>`;
                    div.innerHTML = html;
                } else {
                    div.innerHTML = `<div class="console error">‚úó API returned null</div>`;
                }
            } catch (e) {
                div.innerHTML = `<div class="console error">‚úó API error: ${e.message}</div>`;
            }
        }
        
        function showCities() {
            const div = document.getElementById('cities-output');
            if (typeof cities !== 'undefined' && cities.length > 0) {
                div.innerHTML = `<pre>${JSON.stringify(cities, null, 2)}</pre>`;
            } else {
                div.innerHTML = `<div style="color: red;">Cities array is empty or undefined</div>`;
            }
        }
    </script>
</body>
</html>
