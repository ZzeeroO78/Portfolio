<!DOCTYPE html>
<html>
<head>
    <title>API Test - Final</title>
    <style>
        body {
            font-family: monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
        }
        .success {
            background: #001100;
        }
        .error {
            background: #110000;
            color: #f00;
        }
        h2 {
            color: #0ff;
        }
    </style>
</head>
<body>
    <h1>üî• FINAL API TEST üî•</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function test() {
            // Test 1: Basic fetch
            addResult('‚ïê TEST 1: Basic API Fetch ‚ïê', null);
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=51.5074&longitude=-0.1278&current=temperature_2m&timezone=auto');
                const data = await response.json();
                const temp = data.current.temperature_2m;
                addResult(`‚úì London API returned: ${temp}¬∞C`, true);
            } catch (e) {
                addResult(`‚úó Error: ${e.message}`, false);
            }

            // Test 2: Multiple cities
            addResult('\n‚ïê TEST 2: Multiple Cities ‚ïê', null);
            const cities = {
                'london': { lat: 51.5074, lon: -0.1278 },
                'new york': { lat: 40.7128, lon: -74.0060 },
                'tokyo': { lat: 35.6762, lon: 139.6503 }
            };

            for (const [name, coords] of Object.entries(cities)) {
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m&timezone=auto`;
                    const response = await fetch(url);
                    const data = await response.json();
                    const temp = data.current.temperature_2m;
                    addResult(`‚úì ${name.toUpperCase()}: ${temp}¬∞C`, true);
                } catch (e) {
                    addResult(`‚úó ${name.toUpperCase()}: ${e.message}`, false);
                }
                await new Promise(r => setTimeout(r, 500));
            }

            // Test 3: With timeout
            addResult('\n‚ïê TEST 3: With AbortController Timeout ‚ïê', null);
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 8000);
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.6762&longitude=139.6503&current=temperature_2m&timezone=auto', { signal: controller.signal });
                clearTimeout(timeout);
                const data = await response.json();
                const temp = data.current.temperature_2m;
                addResult(`‚úì Tokyo with timeout: ${temp}¬∞C`, true);
            } catch (e) {
                addResult(`‚úó Error: ${e.message}`, false);
            }

            addResult('\n‚ïê TESTS COMPLETE ‚ïê', null);
        }

        function addResult(msg, success) {
            const div = document.createElement('div');
            if (success === null) {
                div.className = 'result';
                div.style.color = '#0ff';
                div.style.borderColor = '#0ff';
            } else {
                div.className = `result ${success ? 'success' : 'error'}`;
            }
            div.textContent = msg;
            results.appendChild(div);
        }

        test();
    </script>
</body>
</html>
