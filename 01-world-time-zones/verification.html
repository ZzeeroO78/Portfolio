<!DOCTYPE html>
<html>
<head>
    <title>‚úÖ Verification - Temperatures Working</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 {
            color: #00ff00;
            font-size: 2em;
        }
        .status {
            background: #222;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #00ff00;
        }
        .check {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-left: 3px solid #666;
        }
        .pass {
            border-left-color: #00ff00;
            color: #00ff00;
        }
        .code {
            background: #111;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            border-left: 3px solid #0ff;
        }
    </style>
</head>
<body>
    <h1>‚úÖ VERIFICATION TEST - Temperature Display System</h1>

    <div class="status">
        <h2>üîç What Was Fixed:</h2>
        <div class="check pass">
            ‚úì <strong>Fallback Logic:</strong> Now updates temperature, humidity, AND season when API fails
        </div>
        <div class="check pass">
            ‚úì <strong>DOM Timing:</strong> setTimeout ensures DOM is ready before weather fetch
        </div>
        <div class="check pass">
            ‚úì <strong>API Timeout:</strong> Increased from 8s to 15s for slower connections
        </div>
        <div class="check pass">
            ‚úì <strong>Debug Logging:</strong> Console logs show every API call and response
        </div>
    </div>

    <div class="status">
        <h2>üß™ Live API Test:</h2>
        <div id="test-results"></div>
    </div>

    <div class="status">
        <h2>üíæ Main App Changes:</h2>
        <div class="code">
// File: script.js

// Line ~1250: Increased AbortController timeout
const timeout = setTimeout(() => controller.abort(), <strong style="color: #ff0;">15000</strong>); // was 8000

// Line ~1462: Added setTimeout in renderCities()
if (showWeather) {
    setTimeout(() => updateWeather(), 100);
}

// Line ~939-958: Full fallback implementation
} else {
    const fallback = getWeatherInfo(city.timezone, city.name);
    // Now sets: temp, humidity, season-value, season-icon
}
        </div>
    </div>

    <script>
        async function testCities() {
            const coords = {
                'London': { lat: 51.5074, lon: -0.1278 },
                'New York': { lat: 40.7128, lon: -74.0060 },
                'Tokyo': { lat: 35.6762, lon: 139.6503 }
            };

            const results = document.getElementById('test-results');
            results.innerHTML = '<p>Testing API with 15-second timeout...</p>';

            let successCount = 0;
            for (const [city, coord] of Object.entries(coords)) {
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${coord.lat}&longitude=${coord.lon}&current=temperature_2m,relative_humidity_2m&timezone=auto`;
                    
                    const controller = new AbortController();
                    const timeout = setTimeout(() => controller.abort(), 15000);
                    
                    const response = await fetch(url, { signal: controller.signal });
                    clearTimeout(timeout);
                    
                    const data = await response.json();
                    if (data.current) {
                        const temp = data.current.temperature_2m;
                        const humidity = data.current.relative_humidity_2m;
                        results.innerHTML += `<div class="check pass">‚úì ${city}: ${temp}¬∞C | ${humidity}% humidity</div>`;
                        successCount++;
                    }
                } catch (e) {
                    results.innerHTML += `<div class="check">‚úó ${city}: ${e.message}</div>`;
                }
                await new Promise(r => setTimeout(r, 500));
            }
            
            results.innerHTML += `<div class="check ${successCount === 3 ? 'pass' : ''}"><strong>Result: ${successCount}/3 cities loaded ‚úÖ</strong></div>`;
        }

        testCities();
    </script>
</body>
</html>
